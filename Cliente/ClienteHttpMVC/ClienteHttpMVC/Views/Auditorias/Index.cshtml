@using ClienteHttpMVC.DTOs
@model IEnumerable<AuditoriaDTO>

@{
    ViewData["Title"] = "Auditorías de tipos de gasto";
    var listaGastos = ViewBag.Gastos as List<GastoDTO>;
}

<h1>Auditorías de tipos de gasto</h1>

@if (ViewBag.Error != null)
{
    <div class="alert alert-danger">@ViewBag.Error</div>
}

@if (ViewBag.ErrorGastos != null)
{
    <div class="alert alert-warning">Error cargando tipos de gasto: @ViewBag.ErrorGastos</div>
}

<form asp-action="Index" method="get" class="mb-3">
    <div class="input-group">
        <span class="input-group-text">Tipo de gasto</span>
        <select name="idGasto" class="form-select">
            <option value="0">-- Seleccione un tipo de gasto --</option>
            @if (listaGastos != null)
            {
                foreach (GastoDTO g in listaGastos)
                {
                    var seleccionado = (ViewBag.IdGasto != null && (int)ViewBag.IdGasto == g.Id);
                    if (seleccionado)
                    {
                        <option value="@g.Id" selected>@g.Nombre</option>
                    }
                    else
                    {
                        <option value="@g.Id">@g.Nombre</option>
                    }
                }
            }
        </select>
        <button type="submit" class="btn btn-primary">Buscar</button>
    </div>
</form>

@if (Model != null && Model.Any())
{
    <table class="table table-striped mt-3">
        <thead>
            <tr>
                <th>Id Gasto</th>
                <th>Acción</th>
                <th>Fecha</th>
                <th>Id Usuario</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var a in Model)
            {
                <tr>
                    <td>@a.IdGasto</td>
                    <td>@a.Accion</td>
                    <td>@a.Fecha.ToString("dd/MM/yyyy")</td>
                    <td>@a.IdUsuario</td>
                </tr>
            }
        </tbody>
    </table>
}